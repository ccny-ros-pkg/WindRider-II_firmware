

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Command Interface &mdash; WindRider  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/target-highlight.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/doxyrest-pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/doxyrest-sphinx_rtd_theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Code Flow" href="code_flow.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> WindRider
          

          
            
            <img src="../_static/robot.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_and_flash.html">Build and Flash</a></li>
<li class="toctree-l1"><a class="reference internal" href="project_structure.html">Project Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="code_flow.html">Code Flow</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Command Table</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#command-table">Command Table</a></li>
<li class="toctree-l2"><a class="reference internal" href="#current">current</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example">Example:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#peripherals">Peripherals</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#led">led</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Example:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Peripherals</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#servo">servo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4">Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Peripherals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mapping">Mapping</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#solenoid">solenoid</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id7">Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">Peripherals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id9">Mapping</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#suction">suction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id10">Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">Peripherals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id13">Mapping</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#uart">uart</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id14">Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id15">Peripherals</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">WindRider</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Command Interface</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/chapters-rst/command_table.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="command-interface">
<h1>Command Interface<a class="headerlink" href="#command-interface" title="Permalink to this headline">¶</a></h1>
<div class="section" id="command-table">
<h2>Command Table<a class="headerlink" href="#command-table" title="Permalink to this headline">¶</a></h2>
<p>The table of all available commands is shown below.</p>
<table class="colwidths-given docutils align-center">
<colgroup>
<col style="width: 8%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Token</p></th>
<th class="head"><p>Argument 1</p></th>
<th class="head"><p>Argument 2</p></th>
<th class="head"><p>Argument 3</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>current</p></td>
<td><p>None</p></td>
<td><p>None</p></td>
<td><p>None</p></td>
<td><p>Print suction current.</p></td>
</tr>
<tr class="row-odd"><td><p>led</p></td>
<td><p>#channel [0-3]</p></td>
<td><p>[on] or [off]</p></td>
<td><p>None</p></td>
<td><p>Turn led on/off (uses the most recent currentconfiguration)</p></td>
</tr>
<tr class="row-even"><td><p>led</p></td>
<td><p>#channel [0-3]</p></td>
<td><p>current [0-1500]mA</p></td>
<td><p>None</p></td>
<td><p>Set led current.</p></td>
</tr>
<tr class="row-odd"><td><p>Left</p></td>
<td><p>[–30000…30000]</p></td>
<td><p>None</p></td>
<td><p>None</p></td>
<td><p>Set left motor speed.</p></td>
</tr>
<tr class="row-even"><td><p>right</p></td>
<td><p>[–30000…30000]</p></td>
<td><p>None</p></td>
<td><p>None</p></td>
<td><p>Set right motor speed.</p></td>
</tr>
<tr class="row-odd"><td><p>servo</p></td>
<td><p>#channel [0-1]</p></td>
<td><p>Angle [0-180]deg</p></td>
<td><p>None</p></td>
<td><p>Set servo angle.</p></td>
</tr>
<tr class="row-even"><td><p>solenoid</p></td>
<td><p>#channel [0-1]</p></td>
<td><p>[on] or [off]</p></td>
<td><p>None</p></td>
<td><p>Enable/Disable impactor.</p></td>
</tr>
<tr class="row-odd"><td><p>solenoid</p></td>
<td><p>#channel [0-1]</p></td>
<td><p>[0-5000]ms on_time</p></td>
<td><p>[0-5000]ms off_time</p></td>
<td><p>Set impactor on/off time intervals.</p></td>
</tr>
<tr class="row-even"><td><p>straight</p></td>
<td><p>[–30000…30000]</p></td>
<td><p>None</p></td>
<td><p>None</p></td>
<td><p>Speed loaded into both motor drivers synchronously.</p></td>
</tr>
<tr class="row-odd"><td><p>suction</p></td>
<td><p>[on] or [off]</p></td>
<td><p>None</p></td>
<td><p>None</p></td>
<td><p>Enable/Disable suction power.</p></td>
</tr>
<tr class="row-even"><td><p>uart</p></td>
<td><p>[forward]</p></td>
<td><p>[“cmd_to_send”]</p></td>
<td><p>None</p></td>
<td><p>Forward “cmd_to_send” to rs232</p></td>
</tr>
<tr class="row-odd"><td><p>uart</p></td>
<td><p>[reply]</p></td>
<td><p>[on] or [off]</p></td>
<td><p>None</p></td>
<td><p>Print incoming feedback from rs232</p></td>
</tr>
</tbody>
</table>
<p>Detailed command description is presented below.</p>
</div>
<div class="section" id="current">
<h2>current<a class="headerlink" href="#current" title="Permalink to this headline">¶</a></h2>
<p>Prints current supplied to suction motor in mA.</p>
<div class="section" id="example">
<h3>Example:<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>current  <span class="c1">## Request suction current. Command has no arguments.</span>
<span class="m">1234</span>     <span class="c1">## Returned: 1.234 A</span>
</pre></div>
</div>
</div>
<div class="section" id="peripherals">
<h3>Peripherals<a class="headerlink" href="#peripherals" title="Permalink to this headline">¶</a></h3>
<p>Command Handler: <code class="docutils literal notranslate"><span class="pre">HardwareDriver::suction_current(std::string</span> <span class="pre">arg)</span></code></p>
<p><a class="reference external" href="https://github.com/ccny-ros-pkg/WindRider-II_firmware/blob/master/Src/HardwareDriver.cpp#L318">[view source]</a></p>
<p>ADC1 Measures the voltage level on port GPIOA, pin GPIO_PIN_5.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Due to the hardware issues with compatibility of the hall effect sensor with the isolated amplifier, this feature is currently disabled.</p>
</div>
</div>
</div>
<div class="section" id="led">
<h2>led<a class="headerlink" href="#led" title="Permalink to this headline">¶</a></h2>
<p>The led drivers are programmable current sources – adjust the voltage to maintain a set current. This command manipulates the current sources.</p>
<div class="section" id="id1">
<h3>Example:<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configure led brightness. This does not turn leds on.</span>
led <span class="m">0</span> <span class="m">100</span>   <span class="c1">## Set current on channel 0 to 100mA</span>
led <span class="m">1</span> <span class="m">200</span>   <span class="c1">## Set current on channel 1 to 200mA</span>
led <span class="m">2</span> <span class="m">1000</span>  <span class="c1">## Set current on channel 2 to 1A</span>

<span class="c1"># This turns all led channels on at once</span>
led on

<span class="c1"># We can turn all channels off at once as well</span>

led off

<span class="c1"># Or turn channels on/off selectively</span>

led <span class="m">0</span> on    <span class="c1">## Turns on only channel 0.</span>
led <span class="m">2</span> off   <span class="c1">## Turns off only channel 2.</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>Peripherals<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Command Handler: <code class="docutils literal notranslate"><span class="pre">HardwareDriver::led(std::string</span> <span class="pre">arg)</span></code></p>
<p><a class="reference external" href="https://github.com/ccny-ros-pkg/WindRider-II_firmware/blob/master/Src/HardwareDriver.cpp#L262">[view source]</a></p>
<p>Led drivers require pwm input, the duty cycle is mapped proportionally to the current output of the led drivers. The drivers will automatically adjust the voltage to maintain constant current.</p>
<blockquote>
<div><ul class="simple">
<li><p>0% duty cycle    — 0mA current</p></li>
<li><p>100% duty cycle  — 1500mA current</p></li>
</ul>
</div></blockquote>
<p>The pwm generation is mapped to the following peripherals.</p>
<div class="line-block">
<div class="line">LED0 – TIM2_CH1 – GPIO_PIN_0 – GPIOA</div>
<div class="line">LED1 – TIM2_CH2 – GPIO_PIN_1 – GPIOA</div>
</div>
<p>Timer reload frequency is 50Hz (to match with servo control).</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>TIM2 is shared between led drivers and servos.</p>
</div>
</div>
</div>
<div class="section" id="servo">
<h2>servo<a class="headerlink" href="#servo" title="Permalink to this headline">¶</a></h2>
<p>This command manipulates servo angles by adjusting duty cycle on the timer outputs. There are currently two channels allocated for 5V towermicro-like servos.</p>
<div class="section" id="id4">
<h3>Example<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>servo <span class="m">0</span>  <span class="c1">## Set servo to the 0 deg position</span>
servo <span class="m">77</span> <span class="c1">## Set servo to 77 deg position</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>Peripherals<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>Command Handler: <cite>HardwareDriver::servo_angle(std::string arg)</cite></p>
<p><a class="reference external" href="https://github.com/ccny-ros-pkg/WindRider-II_firmware/blob/master/Src/HardwareDriver.cpp#L86">[view source]</a></p>
<p>The servos are driven by <strong>pwm</strong> signal’s <strong>high time</strong>:</p>
<div class="line-block">
<div class="line"><span class="math notranslate nohighlight">\(1ms - 0^o\)</span></div>
<div class="line"><span class="math notranslate nohighlight">\(2ms - 180^o\)</span></div>
</div>
<div class="section" id="mapping">
<h4>Mapping<a class="headerlink" href="#mapping" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">SERVO1 – TIM2_CH3 – GPIO_PIN_10 – GPIOB</div>
<div class="line">SERVO2 – TIM2_CH4 – GPIO_PIN_11 – GPIOB</div>
</div>
<p>Timer reload frequency is 50Hz.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>TIM2 is shared between led drivers and servos.</p>
</div>
</div>
</div>
</div>
<div class="section" id="solenoid">
<h2>solenoid<a class="headerlink" href="#solenoid" title="Permalink to this headline">¶</a></h2>
<p>This command controls the impactors.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Impactor <em>on/off</em> timing must be initialized prior to running the impactors. Improperly initialized timings <strong>can burn the impactors</strong>.</p>
</div>
<p>Once <code class="docutils literal notranslate"><span class="pre">solenoid</span> <span class="pre">0</span> <span class="pre">on</span></code> command has been issued, the impactor at channel 0 will continuously run utilizing the <em>on/off</em> timing pattern. <code class="docutils literal notranslate"><span class="pre">on_time</span></code> corresponds to the time interval in milliseconds when the current is supplied to the impactor. Similarly, <code class="docutils literal notranslate"><span class="pre">off_time</span></code> – current is not supplied.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You might be curious why impactor timing is limited to 2ms. The reason lies in hardware. Solenoids are connected to the 24V line, thought most of the solenoids run at 12V. To mitigate the issue, the output voltage of the solenoid control pin is set to a software generated square wave with 50% duty cycle. The timer responsible for toggling the solenoid control pins runs with a resolution of 1ms, thus min period is 2ms.</p>
</div>
<div class="section" id="id7">
<h3>Example<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">solenoid</span> <span class="mi">0</span> <span class="mi">4</span> <span class="mi">20</span>  <span class="c1">## Configure channel 0 impactor on/off timings.</span>
<span class="n">solenoid</span> <span class="mi">0</span> <span class="n">on</span>    <span class="c1">## Start the impactor at channel 0.</span>
<span class="n">solenoid</span> <span class="mi">0</span> <span class="n">off</span>   <span class="c1">## Stop the impactor at channel 0.</span>
<span class="c1">## Same applies to channel 1.</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h3>Peripherals<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>Command Handler: <code class="docutils literal notranslate"><span class="pre">HardwareDriver::solenoid(std::string</span> <span class="pre">arg)</span></code></p>
<p><cite>[view source] &lt;https://github.com/ccny-ros-pkg/WindRider-II_firmware/blob/master/Src/HardwareDriver.cpp#L202&gt;</cite></p>
<p>Two solenoid transistor switches are driven by gpio pins. TIM3 is used to handle on/off times with 2ms resolution.</p>
<div class="section" id="id9">
<h4>Mapping<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">SOLENOID0_Pin – GPIO_PIN_12 – GPIOB</div>
<div class="line">SOLENOID1_Pin – GPIO_PIN_13 – GPIOB</div>
</div>
<p>SOLENOID1_Pin is defined as SPARE pin on the circuit schematic.</p>
</div>
</div>
</div>
<div class="section" id="suction">
<h2>suction<a class="headerlink" href="#suction" title="Permalink to this headline">¶</a></h2>
<p>This command controls the suction motor power in percentage. The on/off option physically connects and disconnects the suction motor circuit. Setting power before enabling the suction circuitry will result in no action.</p>
<div class="section" id="id10">
<h3>Example<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">suction</span> <span class="n">on</span>   <span class="c1">## Enable suction motor circuitry.</span>
<span class="n">suction</span> <span class="mi">42</span>   <span class="c1">## Set power to 42%.</span>
<span class="n">suction</span> <span class="mi">80</span>   <span class="c1">## Set power to 42%.</span>
<span class="n">suction</span> <span class="mi">0</span>    <span class="c1">## Turn off suction, but keep the circuitry enabled.</span>
<span class="n">suction</span> <span class="n">off</span>  <span class="c1">## Disable suction motor circuitry.</span>
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h3>Peripherals<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>Command Handler: <code class="docutils literal notranslate"><span class="pre">HardwareDriver::suction_power(std::string</span> <span class="pre">arg)</span></code></p>
<p><a class="reference external" href="https://github.com/ccny-ros-pkg/WindRider-II_firmware/blob/master/Src/HardwareDriver.cpp#L140">[view source]</a></p>
<p>Suction motor driver is controlled by a 1kHz pwm signal generated on TIM3. A gpio pin is used to enable/disable the motor circuitry.</p>
<div class="line-block">
<div class="line">0 duty_cycle      – 0% power</div>
<div class="line">0.5 duty_cycle    – 50% power</div>
<div class="line">1 duty_cycle      – 100% power</div>
</div>
<div class="section" id="id13">
<h4>Mapping<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">SUCTION_PWM – TIM3_CH1 – GPIO_PIN_6 – GPIOB</div>
<div class="line">SUCTION_EN_Pin – GPIO_PIN_4 – GPIOA</div>
</div>
</div>
</div>
</div>
<div class="section" id="uart">
<h2>uart<a class="headerlink" href="#uart" title="Permalink to this headline">¶</a></h2>
<p>This command implements usb-to-uart forwarding feature, which allows to forward character strings from the host computer to the uart interface of the microcontroller, in this case connected to rs-232 and further Faulhaber motor drivers.</p>
<div class="section" id="id14">
<h3>Example<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>Let’s say we would like to load a custom configuration into the connected Faulhaber motor drivers.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>uart <span class="s2">&quot;1SP1000&quot;</span>   <span class="c1">## string &quot;1SP1000\r&quot; will be forwarded through uart.</span>
</pre></div>
</div>
<p>Faulhaber motor must have replied something, the reply forwarding is disabled by default. Use the following command to enable the forwarding.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>uart reply on    <span class="c1">## Enables reply forwarding.</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>After issuing the command above everything received on UART will be forwarded to host through USB until <code class="docutils literal notranslate"><span class="pre">uart</span> <span class="pre">reply</span> <span class="pre">off</span></code> is issued.</p>
</div>
</div>
<div class="section" id="id15">
<h3>Peripherals<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<p>Command Handler: <code class="docutils literal notranslate"><span class="pre">HardwareDriver::uart(std::string</span> <span class="pre">arg)</span></code></p>
<p><a class="reference external" href="https://github.com/ccny-ros-pkg/WindRider-II_firmware/blob/master/Src/HardwareDriver.cpp#L325">[view source]</a></p>
<p><code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">FaulhaberComm</span></code> class implements helper methods to send and receive strings via USART1 peripheral. Please see <em>FaulhaberComm.cpp/h</em> for the further description.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="code_flow.html" class="btn btn-neutral float-left" title="Code Flow" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>